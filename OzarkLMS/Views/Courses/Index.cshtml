@model IEnumerable<OzarkLMS.Models.Course>

<div class="p-8 lg:p-12 max-w-[1600px] mx-auto h-full flex flex-col">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-4xl font-extrabold text-[#2D3B45] dark:text-white mb-8 tracking-tight">All Courses</h1>
        @if(User.IsInRole("admin") || User.IsInRole("instructor"))
        {
            <a asp-action="Create" class="bg-[#2D3B45] dark:bg-slate-700 text-white px-6 py-3 rounded-full flex items-center shadow-lg hover:bg-[#1f2930] dark:hover:bg-slate-600 transition-colors">
                <i data-lucide="plus" class="w-5 h-5 mr-2"></i> New Course
            </a>
        }
    </div>

    <div class="bg-white dark:bg-slate-900 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-800 overflow-hidden flex-1 flex flex-col min-h-0">
        @if (!Model.Any())
        {
            <div class="p-20 text-center text-slate-400 dark:text-slate-500 flex flex-col items-center">
                <i data-lucide="book" class="w-12 h-12 mb-4 text-slate-300 dark:text-slate-600"></i>
                <p class="text-lg">No courses available.</p>
            </div>
        }
        else
        {
            <div class="overflow-y-auto flex-1 divide-y divide-slate-50 dark:divide-slate-800">
                @foreach (var course in Model)
                {
                    <div class="p-6 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors cursor-pointer flex items-center justify-between group">
                        <a asp-action="Details" asp-route-id="@course.Id" class="flex items-center space-x-6 flex-1">
                            <div class="w-14 h-14 rounded-2xl @course.Color flex items-center justify-center text-3xl text-white shadow-md">
                                @course.Icon
                            </div>
                            <div>
                                <h3 class="font-bold text-[#2D3B45] dark:text-white text-lg group-hover:text-[#BF2604] dark:group-hover:text-red-400 transition-colors">@course.Name</h3>
                                <p class="text-sm text-slate-500 dark:text-slate-400 font-medium mb-1">@course.Code â€¢ @course.Term</p>
                                @if(course.Instructor != null)
                                {
                                    <div class="flex items-center">
                                        @if(!string.IsNullOrEmpty(course.Instructor.ProfilePictureUrl))
                                        {
                                            <img src="@course.Instructor.ProfilePictureUrl" class="w-5 h-5 rounded-full object-cover mr-2 bg-gray-200" alt="Instructor" />
                                        }
                                        else
                                        {
                                            <div class="w-5 h-5 rounded-full bg-blue-100 dark:bg-blue-800 text-[#004B87] dark:text-blue-100 flex items-center justify-center font-bold mr-2 text-[10px]">
                                                @(course.Instructor.Username.Substring(0,1).ToUpper())
                                            </div>
                                        }
                                        <span class="text-xs text-slate-500 dark:text-slate-400">Dr. @course.Instructor.Username</span>
                                    </div>
                                }
                            </div>
                        </a>
                        <div class="flex items-center space-x-2">
                             @if(User.IsInRole("admin") || User.IsInRole("instructor"))
                             {
                                 <a asp-action="ManageStudents" asp-route-id="@course.Id" class="text-xs font-bold text-[#004B87] dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30 px-3 py-1.5 rounded-lg hover:bg-[#004B87] dark:hover:bg-blue-800 hover:text-white transition-colors z-10 relative">
                                     Manage Students
                                 </a>
                             }
                             
                             @{
                                 var userIdClaim = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value ?? User.FindFirst("UserId")?.Value ?? "0";
                                 var currentUserId = int.Parse(userIdClaim);
                             }
                             
                             @if(User.IsInRole("admin") || (User.IsInRole("instructor") && course.InstructorId == currentUserId))
                             {
                                 <button onclick="openDeleteModal(@course.Id, '@course.Name')" class="text-slate-400 hover:text-red-600 dark:hover:text-red-400 transition-colors z-10 relative p-1.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg">
                                     <i data-lucide="trash-2" class="w-4 h-4"></i>
                                 </button>
                             }
                             <div class="text-slate-300 dark:text-slate-600 group-hover:text-slate-500 dark:group-hover:text-slate-400 transition-colors">
                                <i data-lucide="chevron-right"></i>
                             </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity" onclick="closeDeleteModal()"></div>
    
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-2xl bg-white dark:bg-slate-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-md border border-slate-100 dark:border-slate-700">
                <div class="p-6">
                    <div class="flex items-center justify-center w-12 h-12 mx-auto bg-red-100 dark:bg-red-900/30 rounded-full mb-4">
                        <i data-lucide="alert-triangle" class="w-6 h-6 text-red-600 dark:text-red-400"></i>
                    </div>
                    <div class="text-center">
                        <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-2" id="modal-title">Delete Course</h3>
                        <p class="text-sm text-slate-500 dark:text-slate-400">
                            Are you sure you want to delete <span id="deleteCourseName" class="font-bold text-slate-800 dark:text-slate-200"></span>? 
                            This action cannot be undone.
                        </p>
                    </div>
                </div>
                <div class="bg-slate-50 dark:bg-slate-700/50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <form asp-action="Delete" method="post" class="w-full sm:w-auto sm:ml-3">
                        <input type="hidden" id="deleteCourseId" name="id" value="" />
                        <button type="submit" class="inline-flex w-full justify-center rounded-xl bg-red-600 px-3 py-2 text-sm font-bold text-white shadow-sm hover:bg-red-500 sm:w-auto transition-colors">
                            Delete Course
                        </button>
                    </form>
                    <button type="button" onclick="closeDeleteModal()" class="mt-3 inline-flex w-full justify-center rounded-xl bg-white dark:bg-slate-800 px-3 py-2 text-sm font-bold text-slate-900 dark:text-slate-300 shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 sm:mt-0 sm:w-auto transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function openDeleteModal(id, name) {
        document.getElementById('deleteCourseId').value = id;
        document.getElementById('deleteCourseName').innerText = name;
        document.getElementById('deleteModal').classList.remove('hidden');
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.add('hidden');
    }
</script>
