@* 
    Animated Background Partial 
    - Rendered on Login and Register pages.
    - Contains 2D Outline-style animations for Books and Laptops.
*@

<div id="auth-background" class="fixed inset-0 z-0 overflow-hidden pointer-events-none select-none transition-colors duration-300" aria-hidden="true">
    <!-- SVGs are injected here by JS -->
</div>

<style>
    /* Base Animation Container settings */
    #auth-background {
        --stroke-color: rgba(0, 0, 0, 0.8); /* Darker for better visibility */
        --fill-color: transparent;
    }
    .dark #auth-background {
        --stroke-color: rgba(255, 255, 255, 0.8);
    }

    /* Common SVG Styles */
    .auth-bg-item {
        position: absolute;
        stroke: var(--stroke-color);
        stroke-width: 1.5;
        fill: none;
        will-change: transform, opacity;
        opacity: 0; /* Start invisible */
    }

    /* Book Animation: Faster open/close */
    .book-cover {
        transform-origin: center right;
        transform-style: preserve-3d;
        animation: bookOpenClose 4s ease-in-out infinite;
    }
    
    @@keyframes bookOpenClose {
        0%, 100% { transform: rotateY(0deg); }
        50% { transform: rotateY(-45deg); }
    }

    /* Laptop Text: Base style */
    .laptop-text {
        stroke: none;
        font-family: 'Inter', sans-serif;
        font-weight: bold;
        font-size: 11px;
        text-anchor: middle;
        opacity: 1; /* Visibility controlled by container fade, but text changes */
    }

    /* Motion: Checkpoint - Smoother Float & Fade */
    .dynamic-motion {
        animation: 
            fadeInOut 8s ease-in-out infinite,
            float 12s ease-in-out infinite alternate;
    }

    /* Keyframes: Smooth Float (Vertical + Slight Rotation) */
    @@keyframes float {
        0% { transform: translateY(0px) rotate(0deg); }
        33% { transform: translateY(-10px) rotate(2deg); }
        67% { transform: translateY(5px) rotate(-1deg); }
        100% { transform: translateY(0px) rotate(0deg); }
    }

    /* Keyframes: Gentle Fade In/Out */
    @@keyframes fadeInOut {
        0% { opacity: 0; }
        20% { opacity: 1; }
        80% { opacity: 1; }
        100% { opacity: 0; }
    }

    /* Keyframes: Drift (Horizontal - Optional, kept for variety if needed, but not used in base class now) */
    @@keyframes drift {
        0% { transform: translate(0, 0); }
        100% { transform: translate(20px, -15px); }
    }
    
    /* Reduced Motion */
    @@media (prefers-reduced-motion: reduce) {
        .auth-bg-item, .book-cover, .dynamic-motion {
            animation: none !important;
            opacity: 0.3 !important; /* Static visible */
            transform: none !important;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('auth-background');
        const names = ["Ifrad", "Gonzalo", "Sanyoung", "Sebastian", "Luis"];
        const colors = [
            "#EF4444", // Red
            "#3B82F6", // Blue
            "#10B981", // Emerald
            "#F59E0B", // Amber
            "#8B5CF6", // Violet
            "#EC4899"  // Pink
        ];
        
        // Grid Configuration for Non-Overlap (12x12 for finer control)
        const cols = 12;
        const rows = 12;
        const totalCells = cols * rows;
        
        // Exclude central zone for the login form AND edges
        const excludedIndices = [];
        
        // Center Exclusion (Login Form area)
        for (let r = 2; r <= 9; r++) {
            for (let c = 3; c <= 8; c++) {
                excludedIndices.push(r * cols + c);
            }
        }

        // Edge Exclusion (Keep items away from screen borders)
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                if (r === 0 || r === rows - 1 || c === 0 || c === cols - 1) {
                    const idx = r * cols + c;
                    if (!excludedIndices.includes(idx)) excludedIndices.push(idx);
                }
            }
        }
        
        let availableIndices = [];
        for(let i=0; i<totalCells; i++) {
            if(!excludedIndices.includes(i)) availableIndices.push(i);
        }
        
        // Templates (Larger dimensions as requested)
        const laptopSvg = (name, color, delay, duration) => `
            <svg class="auth-bg-item dynamic-motion" width="100" height="70" viewBox="0 0 120 80" 
                 style="animation-delay: -${delay}s; animation-duration: ${duration}s;">
                <rect x="10" y="5" width="100" height="60" rx="4" />
                <path d="M 0 65 L 120 65 L 110 75 L 10 75 Z" />
                <text x="60" y="40" class="laptop-text" fill="${color}">${name}</text>
            </svg>
        `;

        const desktopSvg = (type, name, color, delay, duration) => {
            const isWide = type === 'wide';
            const monitorWidth = isWide ? 100 : 80;
            const viewBoxWidth = isWide ? 160 : 140; 
            
            return `
            <svg class="auth-bg-item dynamic-motion" width="${viewBoxWidth * 0.8}" height="80" viewBox="0 0 ${viewBoxWidth} 100" 
                 style="animation-delay: -${delay}s; animation-duration: ${duration}s;">
                <g transform="translate(10, 0)">
                    <rect x="0" y="0" width="${monitorWidth}" height="60" rx="2" stroke-width="1.5" />
                    <line x1="${monitorWidth/2}" y1="60" x2="${monitorWidth/2}" y2="75" stroke-width="3" />
                    <line x1="${monitorWidth/2 - 15}" y1="75" x2="${monitorWidth/2 + 15}" y2="75" stroke-width="2" />
                    <text x="${monitorWidth/2}" y="35" class="laptop-text" fill="${color}">${name}</text>
                </g>
                <g transform="translate(${monitorWidth + 25}, 15)"> 
                    <path d="M 0 0 L 20 0 L 24 -6 L 4 -6 Z" stroke-width="1.5" stroke-linejoin="round" />
                    <rect x="0" y="0" width="20" height="80" rx="2" />
                    <text x="10" y="40" text-anchor="middle" font-size="8" stroke="none" fill="#2563EB" 
                          style="writing-mode: tb; opacity: 1; font-family: 'Inter', sans-serif; font-weight: bold;">OZARK</text>
                    <circle cx="10" cy="10" r="2" fill="#2563EB" stroke="none" />
                </g>
                <g transform="translate(10, 80)">
                    <rect x="0" y="0" width="${monitorWidth}" height="15" rx="2" />
                    <rect x="${monitorWidth + 5}" y="2" width="10" height="12" rx="4" />
                </g>
            </svg>
            `;
        };

        const bookSvg = (delay, duration) => `
            <svg class="auth-bg-item dynamic-motion" width="80" height="100" viewBox="0 0 100 120" 
                 style="animation-delay: -${delay}s; animation-duration: ${duration}s;">
                <rect x="10" y="10" width="80" height="100" rx="2" />
                <g class="book-cover">
                    <rect x="10" y="10" width="80" height="100" rx="2" fill="none" style="fill: transparent;" />
                    <line x1="15" y1="10" x2="15" y2="110" />
                    <text x="50" y="60" text-anchor="middle" font-size="10" stroke="none" fill="#DC2626" style="opacity: 1; font-weight: bold;">Ozark LMS</text>
                </g>
                <path d="M 15 110 Q 50 115 90 110" stroke-linecap="round" />
            </svg>
        `;

        // Shuffle Array
        availableIndices.sort(() => Math.random() - 0.5);
        
        // Spawn - Increased density slightly (+5-10%) and added disarray
        const itemCount = 22;
        const cellsToUse = availableIndices.slice(0, itemCount); 
        
        cellsToUse.forEach(cellIndex => {
            const rand = Math.random();
            let type = 'book';
            if (rand < 0.35) type = 'laptop';
            else if (rand < 0.70) type = 'desktop';
            
            const containerDiv = document.createElement('div');
            
            // Grid Position
            const col = cellIndex % cols;
            const row = Math.floor(cellIndex / cols);
            
            // Center within cell + LARGER jitter for "disarray"
            // Increased range to +/- 6% (was +/- 2%) to break the grid look
            const jitterX = (Math.random() * 12) - 6; 
            const jitterY = (Math.random() * 12) - 6;
            
            const left = (col * (100/cols)) + (100/(cols*2)) + jitterX;
            const top = (row * (100/rows)) + (100/(rows*2)) + jitterY;
            
            // Random Rotation for "disarray"
            const rotation = (Math.random() * 30) - 15; // +/- 15 degrees
            
            containerDiv.style.position = 'absolute';
            containerDiv.style.left = left + '%';
            containerDiv.style.top = top + '%';
            containerDiv.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
            
            // Randomize timing
            const delay = Math.random() * 8; // Wider range for more varied start
            const duration = 6 + Math.random() * 4;

            if (type === 'laptop' || type === 'desktop') {
                const initialName = names[Math.floor(Math.random() * names.length)];
                const initialColor = colors[Math.floor(Math.random() * colors.length)];
                
                if (type === 'laptop') {
                    containerDiv.innerHTML = laptopSvg(initialName, initialColor, delay, duration);
                } else {
                    const desktopType = Math.random() > 0.5 ? 'wide' : 'normal';
                    containerDiv.innerHTML = desktopSvg(desktopType, initialName, initialColor, delay, duration);
                }
                
                const textEl = containerDiv.querySelector('.laptop-text');
                
                // Update Name & Color frequently
                setInterval(() => {
                    const n = names[Math.floor(Math.random() * names.length)];
                    const c = colors[Math.floor(Math.random() * colors.length)];
                    if(textEl) {
                        textEl.textContent = n;
                        textEl.setAttribute('fill', c);
                    }
                }, 3000 + Math.random() * 2000); // Async updates
            } else {
                containerDiv.innerHTML = bookSvg(delay, duration);
            }
            
            container.appendChild(containerDiv);
        });
    });
</script>
